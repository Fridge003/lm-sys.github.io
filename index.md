---
layout: default
title: GPT-4 Says An Open-Source Chatbot <span style="font-style:italic;">Vicuna</span> Reaches 90% ChatGPT Quality
description: by the Team with members from UC Berkeley, CMU, Stanford, and UC San Diego
---

## TL;DR
Introducing Vicuna-13B, an open-source chatbot trained by fine-tuning LLaMa on user-shared conversations collected from ShareGPT. Preliminary evaluation using GPT-4 as a judge shows Vicuna-13B achieves 90% quality of OpenAI ChatGPT and Google Bard while outperforming other models like LLaMa and Stanford Alpaca in more than 88% of cases. The cost of training Vicuna-13B is around $300. The training and serving [code](https://github.com/lm-sys/ChatServer), along with an online [demo](), are publicly available for non-commercial use.

![favicon](favicon.jpeg){: style="display:block; margin-left: auto; margin-right: auto;" width="30%"}

Vicuna
(generated by stable diffusion 2.1)
{: style="color:gray; font-size: 80%; text-align: center;"}

## Sample Output
Here is an example of our evaluation. We ask the two models the same question and let GPT-4 assess the response quality. GPT-4 favors the response generated by Vicuna-13B over Alpaca-13B in this case.

{% include embedded-eval.html %}
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{border-color:#ccc;border-style:solid;border-width:1px;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-llyw{background-color:#c0c0c0;border-color:#ccc;text-align:left;vertical-align:top;color:#000;}
.tg .tg-1wig{text-align:left;vertical-align:top;color:#000;}
</style>

---

<!-- embed eval table -->

Similarly, we evaluate five models on a set of 80 challenging benchmark questions generated by GPT-4. These questions span various topics, such as common-sense, counterfactuals, roleplay, writing, and coding. With careful prompt engineering, we are able to ask GPT-4 to examine the quality of answers from each model and rate overall scores. More details are provided in the evaluation section. We summarize the relative scores in the Figure 1 below, which shows that Vicuna-13B achieves 90% quality compared to ChatGPT.

![chart](assets/vicuna/chart.png){: style="display:block; margin-left: auto; margin-right: auto;" width="60%"}
Figure 1. Relative Response Quality Assessed by GPT-4
{: style="color:gray; font-size: 80%; text-align: center;"}


## Online Demo
Try the Vicuna-13B demo [here]().
<!-- <iframe src="http://34.150.184.74:7860/" frameBorder="0" width="100%" height="900"></iframe> -->
[a gif screenshot]

## Overview
The rapid advancement of large language models (LLMs) has revolutionized chatbot systems, resulting in unprecedented levels of intelligence as seen in OpenAI's ChatGPT. However, despite its impressive performance, the training and architecture details of ChatGPT remain unclear, hindering research and open-source innovation in this field. Inspired by the Meta LLaMa and Stanford Alpaca project, we introduce Vicuna-13B, an open-source chatbot backed by an enhanced dataset and an easy-to-use, scalable infrastructure. By fine-tuning a LLaMa base model on user-shared conversations collected from ShareGPT.com, Vicuna-13B has demonstrated competitive performance compared to other open-source models like Stanford Alpaca. This blog post provides a preliminary evaluation of Vicuna-13B's performance and describes its training and serving infrastructure. We also invite the community to interact with our online demo to test the capabilities of this chatbot.

![Workflow](assets/vicuna/workflow.png){: style="display:block; margin-left: auto; margin-right: auto;" width="70%"}
Figure 2. Workflow Overview
{: style="color:gray; font-size: 80%; text-align: center;"}

Figure 2 provides an overview of our work. To begin, we collected around 70K conversations from ShareGPT.com, a website where users can share their ChatGPT conversations. Next, we enhanced the training scripts provided by Alpaca to better handle multi-round conversations and long sequences. The training was done with PyTorch FSDP on 8 A100 GPUs in one day. For serving the demo, we implemented a lightweight distributed serving system. We conducted a preliminary evaluation of the model quality by creating a set of 80 diverse questions and utilizing GPT-4 to judge the model outputs. To compare two different models, we combine the outputs from each model into a single prompt for each question. The prompts are then sent to GPT-4, which assesses which model provides better responses. A detailed comparison of LLaMa, Alpaca, ChatGPT, and Vicuna is shown in the Table 1 below.

Table 1. Comparison between several notable models
{: style="color:gray; font-size: 80%; text-align: center;"}


<table class="tg" style="display: flex;justify-content: center;">
<tbody>
  <tr>
    <td class="tg-llyw"><span style="font-weight:bold;">Model Name</span></td>
    <td class="tg-llyw"><span style="font-weight:bold;">LLaMA</span></td>
    <td class="tg-llyw"><span style="font-weight:bold;">Alpaca</span></td>
    <td class="tg-llyw"><span style="font-weight:bold;">Vicuna</span></td>
    <td class="tg-llyw"><span style="font-weight:bold;">ChatGPT</span></td>
  </tr>
  <tr>
    <td class="tg-1wig">Dataset</td>
    <td class="tg-1wig">Publicly available datasets<br>(1T token)</td>
    <td class="tg-1wig">Self-instruct from davinci-003 API<br>(52K samples)</td>
    <td class="tg-1wig">User-shared conversations<br>(70K samples)</td>
    <td class="tg-1wig">N/A</td>
  </tr>
  <tr>
    <td class="tg-1wig">Training code</td>
    <td class="tg-1wig">N/A</td>
    <td class="tg-1wig">Available</td>
    <td class="tg-1wig">Available</td>
    <td class="tg-1wig">N/A</td>
  </tr>
  <tr>
    <td class="tg-1wig">Evaluation metrics</td>
    <td class="tg-1wig">Academic benchmark</td>
    <td class="tg-1wig">Author evaluation</td>
    <td class="tg-1wig">GPT-4 assessment</td>
    <td class="tg-1wig">Mixed</td>
  </tr>
  <tr>
    <td class="tg-1wig">Training cost<br>(7B)</td>
    <td class="tg-1wig">82K GPU-hours</td>
    <td class="tg-1wig">$500 (data) + $100 (training)</td>
    <td class="tg-1wig">$140 (training)</td>
    <td class="tg-1wig">N/A</td>
  </tr>
  <tr>
    <td class="tg-1wig">Training cost<br>(13B)</td>
    <td class="tg-1wig">135K GPU-hours</td>
    <td class="tg-1wig">N/A</td>
    <td class="tg-1wig">$300 (training)</td>
    <td class="tg-1wig">N/A</td>
  </tr>
</tbody>
</table>

## Training
Vicuna is created by fine-tuning a LLaMa base model using approximately 70K user-shared conversations gathered from ShareGPT.com. To ensure data quality, we convert the HTML back to markdown and filter out some inappropriate or low-quality samples. Additionally, we divide lengthy conversations into smaller segments that fit the model's maximum context length.

Our training recipe builds on top of [Stanford’s alpaca](https://crfm.stanford.edu/2023/03/13/alpaca.html) with the following improvements.
- Memory Optimizations: To enable Vicuna's understanding of long context, we expand the max context length from 512 in alpaca to 2048, which substantially increases GPU memory requirements. We tackle the memory pressure by utilizing [gradient checkpointing](https://arxiv.org/abs/1604.06174) and [flash attention](https://arxiv.org/abs/2205.14135).
- Multi-round conversations. We adjust the training loss to account for multi-round conversations and compute the fine-tuning loss solely on the chatbot's output.
- Cost Reduction via Spot Instance: The 40x larger dataset and 4x sequence length for training poses a considerable challenge in training expenses.We employ [SkyPilot](https://github.com/skypilot-org/skypilot) managed spot to reduce the cost by leveraging the cheaper spot instances with auto-recovery for preemptions and auto zone switch. This solution slashes costs for training the 7B model from $500 to around $140 and 13B model from around $1K to $300.

## Serving
We build a serving system that is capable of serving multiple models with distributed workers. It supports flexible plug-in of GPU workers from both on-premise clusters and the cloud. By utilizing a fault-tolerant controller and managed spot feature in SkyPilot, this serving system can work well with cheaper spot instances from multiple clouds to reduce the serving costs. It is currently a lightweight implementation and we are working on integrating more of our latest [research](https://arxiv.org/abs/2302.11665) into it.

## How To Evaluate a Chatbot?
Evaluating AI chatbots is a challenging task, as it requires examining language understanding, reasoning, and context awareness. With AI chatbots becoming more advanced, current open benchmarks may no longer suffice. For instance, the evaluation dataset used in Stanford’s Alpaca and self-instruct, can be essentially solved by the SOTA chatbots. More limitations include training/test data contamination and the potential high cost of creating new benchmarks. To tackle these issues, we propose an evaluation framework based on GPT-4 to automate chatbot performance assessment.

First, we devised eight question categories, such as Fermi problems, roleplay scenarios, and coding/math tasks, to test various aspects of a chatbot's performance. Through careful prompt engineering, GPT-4 is able to generate diverse, challenging questions that baseline models struggle with. We select ten questions per category (details: Benchmark question) and collect answers from five chatbots: LLaMA, Alpaca, ChatGPT, Bard, and Vicuna. We then ask GPT-4 to rate the quality of their answers based on helpfulness, relevance, accuracy, and detail. We discover that GPT-4 can produce not only consistent scores but also detailed explanations on why such scores are given (detailed examples link).

Figure 3. Response Comparison Assessed by GPT-4
{: style="color:gray; font-size: 80%; text-align: center;"}

Figure 3 displays the comparison results between all baselines and Vicuna. GPT-4 prefers Vicuna over state-of-the-art open-source models (LLaMA, Alpaca) in more than 88% of the questions, and it achieves competitive performance against proprietary models (ChatGPT, Bard). In 57.5% of the questions, GPT-4 rates Vicuna's response as better or equal to ChatGPT's, and Vicuna's total score reaches 93% of ChatGPT’s (see Table 2). Despite advancements, those chatbots still face limitations, such as struggling with basic math problems or limited coding ability (link).

Table 2. Response Scores Assessed by GPT-4
{: style="color:gray; font-size: 80%; text-align: center;"}

<table class="tg" style="display: flex;justify-content: center;">
<tbody>
  <tr>
    <td class="tg-llyw"><span style="font-weight:bold;">Baseline</span></td>
    <td class="tg-llyw"><span style="font-weight:bold;">Baseline Score</span></td>
    <td class="tg-llyw"><span style="font-weight:bold;">Vicuna Score</span></td>
  </tr>
  <tr>
    <td class="tg-1wig">LLaMA-13B</td>
    <td class="tg-1wig">525.5</td>
    <td class="tg-1wig"><span style="font-weight:bold;">678.5</span></td>
  </tr>
  <tr>
    <td class="tg-1wig">Alpaca-13B</td>
    <td class="tg-1wig">603.5</td>
    <td class="tg-1wig"><span style="font-weight:bold;">692.0</span></td>
  </tr>
  <tr>
    <td class="tg-1wig">Bard</td>
    <td class="tg-1wig"><span style="font-weight:bold;">661.0</span></td>
    <td class="tg-1wig">645.0</td>
  </tr>
  <tr>
    <td class="tg-1wig">ChatGPT</td>
    <td class="tg-1wig"><span style="font-weight:bold;">678.0</span></td>
    <td class="tg-1wig">632.0</td>
  </tr>
</tbody>
</table>

While this proposed evaluation framework demonstrates the potential for assessing chatbots, it is not yet a rigorous and mature approach. Developing a comprehensive, standardized evaluation system for chatbots remains an open question requiring further research.

## Limitations
We have noticed that, similar to other large language models, Vicuna has certain limitations. For instance, it is not good at tasks involving reasoning or mathematics, and it may have limitations in accurately identifying itself or ensuring the factual accuracy of its outputs. Furthermore, it may not be adequately optimized to ensure safety. Nonetheless, we anticipate that Vicuna can serve as an open starting point for future research to tackle these limitations.

## License
The online demo is a research preview intended for non-commercial use only, subject to the model [License](https://github.com/facebookresearch/llama/blob/main/MODEL_CARD.md) of LLaMA, [Terms of Use](https://openai.com/policies/terms-of-use) of the data generated by OpenAI, and [Privacy Practices](https://chrome.google.com/webstore/detail/sharegpt-share-your-chatg/daiacboceoaocpibfodeljbdfacokfjb) of ShareGPT. Please contact us If you find any potential violation.
The code is released under the Apache License 2.0.


## The Team
This is a joint effort with collaborators from multiple institutions, including UC Berkeley, CMU, Stanford, and UC San Diego.

**Students in alphabetical order:**
Wei-Lin Chiang, Zhuohan Li, Zi Lin, Ying Sheng, Zhanghao Wu, Hao Zhang, Lianmin Zheng, Siyuan Zhuang, Yonghao Zhuang

## Acknowledgment
We would like to thank Xinyang Geng, Hao Liu, and Eric Wallace for their insightful discussion and feedback. Please check out another concurrent effort from BAIR.
